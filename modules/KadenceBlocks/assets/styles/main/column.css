/**
 * Kadence Column block styling.
 *
 * ============================================================================
 * FRONTEND HTML STRUCTURE (public page view)
 * ============================================================================
 *
 * <div class="wp-block-kadence-column kadence-column{ID} kt-column-has-bg">
 *   <div class="kt-inside-inner-col">
 *     <!-- Column content -->
 *   </div>
 * </div>
 *
 * Key classes:
 * - .wp-block-kadence-column : Block identifier / outer wrapper
 * - .kadence-column{ID}      : Unique column identifier (no hyphen before ID)
 * - .kt-column-has-bg        : Present when column has background
 * - .kt-inside-inner-col     : Inner content wrapper (flex container)
 *
 * ============================================================================
 * EDITOR HTML STRUCTURE
 * ============================================================================
 * See admin-editor/column.css for editor markup (inner wrapper class differs).
 *
 */

.kt-inside-inner-col,
.kadence-inner-column-inner {
    /* Zero margin to allow default gap instead (see content-flow in KadenceBlocks.php and column-gap-defaults.js */
    > * {
        margin-block-start: 0;
        margin-block-end: 0;
    }

    /**
     * Optical spacing correction for elements with strong visual boundaries.
     *
     * Elements with hard edges (images, videos, code blocks, etc.) create perceived
     * separation through their visual boundary alone. When followed by text, the gap
     * appears larger than the same spacing between two text elements—even though the
     * actual value is identical.
     *
     * This offset adds a small amount of margin to compensate, making the visual
     * rhythm feel consistent across different element combinations.
     *
     * Other elements that may benefit from this treatment:
     * - .wp-block-video, .wp-block-embed (hard rectangular edges)
     * - .wp-block-cover (full-width background creates visual break)
     * - .wp-block-code, .wp-block-preformatted (background creates a "box")
     * - .wp-block-table (borders/cells create strong edges)
     * - .wp-block-separator (already a visual divider, gap looks doubled)
     * - .wp-block-gallery (collection of hard-edged images)
     * - .wp-block-buttons (solid background creates edge when block-level)
     * - .wp-block-quote, .wp-block-pullquote (when styled with border/background)
     */
    > .wp-block-kadence-image:not(:last-child) {
        margin-bottom: var(--wp--custom--visual-edge-offset);
    }
    > .wp-block-kadence-image:not(:first-child) {
        margin-top: var(--wp--custom--visual-edge-offset);
    }
}

/* Container establishment for width-responsive padding (only on columns with backgrounds) */
:where(.kt-row-column-wrap) > .wp-block-kadence-column.kt-column-has-bg {
    container-name: kadence-column;
    container-type: inline-size;
}

/*
 * Reset padding variables in multi-column layouts to prevent inheritance from row.
 * Single-column rows retain inheritance so alignfull children can break out to row edge.
 * Mobile stacked columns also retain inheritance for full-viewport breakout.
 * Columns with backgrounds override these with their own values.
 */
@media (min-width: 768px) {
    :where(.kt-row-column-wrap:not(.kt-has-1-columns) > .wp-block-kadence-column > .kt-inside-inner-col) {
        --kb-padding-left: 0;
        --kb-padding-right: 0;
    }
}

/**
 * Columns with backgrounds — structure-based vertical padding.
 *
 * Specificity: 0,1,0 - allows Kadence editor styles (0,2,0) to override
 *
 * Base: columns are cards (tight vertical, container-inner-h-sm horizontal).
 * Section contexts (top-level, single-column row) get generous vertical.
 * Wide containers upgrade horizontal padding to container-inner-h-lg.
 */
:where(.kt-column-has-bg) > .kt-inside-inner-col {
    --kb-padding-top: var(--wp--custom--container-inner-v-sm);
    --kb-padding-bottom: var(--wp--custom--container-inner-v-sm);
    --kb-padding-left: var(--wp--custom--container-inner-h-sm);
    --kb-padding-right: var(--wp--custom--container-inner-h-sm);
    padding: var(--kb-padding-top) var(--kb-padding-right) var(--kb-padding-bottom) var(--kb-padding-left);
}

/* Section contexts: generous vertical padding, root-aligned horizontal padding */
:where(.wp-site-blocks > .wp-block-kadence-column.kt-column-has-bg) > .kt-inside-inner-col,
:where(.kt-has-1-columns > .wp-block-kadence-column.kt-column-has-bg) > .kt-inside-inner-col {
    --kb-padding-top: var(--wp--custom--container-inner-v-lg);
    --kb-padding-bottom: var(--wp--custom--container-inner-v-lg);
    --kb-padding-left: var(--wp--style--root--padding-left);
    --kb-padding-right: var(--wp--style--root--padding-right);
}

/* Wide containers: upgrade horizontal padding to container-inner-h-lg */
@container kadence-column (min-width: 580px) {
    :where(.kt-column-has-bg) > .kt-inside-inner-col {
        --kb-padding-left: var(--wp--custom--container-inner-h-lg);
        --kb-padding-right: var(--wp--custom--container-inner-h-lg);
    }
}

/*
 * Nested Section (Column-in-Column) width constraints.
 *
 * At the top level, .is-layout-constrained on the article provides max-width
 * for child blocks: content-size by default, wide-size for .alignwide, and
 * unconstrained for .alignfull. But when a Section is nested inside another
 * Section's .kt-inside-inner-col, that constraint is lost.
 *
 * These rules replicate is-layout-constrained behavior for the nested case.
 * Only matches Section-in-Section (columns inside multi-column rows are
 * children of .kt-row-column-wrap, not .kt-inside-inner-col).
 *
 * Specificity: 0,2,0 — structural constraints; Kadence user-set widths
 * override via inline styles (1,0,0).
 */
.kt-inside-inner-col {
    > .wp-block-kadence-column:where(:not(.alignfull)) {
        max-width: var(--wp--style--global--content-size);
        margin-inline: auto;
    }

    > .wp-block-kadence-column:where(.alignwide) {
        max-width: var(--wp--style--global--wide-size);
    }

    > .alignfull {
        margin-left: calc(-1 * var(--kb-padding-left));
        margin-right: calc(-1 * var(--kb-padding-right));
    }
}
