/**
 * Kadence Column block editor preview styles.
 *
 * Mirrors frontend column.css rules for WYSIWYG preview in the editor.
 *
 * ============================================================================
 * EDITOR HTML STRUCTURE (block editor preview)
 * ============================================================================
 *
 * <div class="wp-block-kadence-column kadence-column inner-column-{N} kadence-column-{ID} kt-column-has-bg">
 *   <style>...</style>
 *   <div class="kadence-inner-column-inner kt-animation-wrap kadence-inner-column-direction-vertical kadence-inner-column-text-align-normal kadence-inner-column-vertical-align-inherit block-editor-block-list__layout">
 *     <!-- Column content -->
 *   </div>
 * </div>
 *
 * Key differences from frontend:
 * - Inner wrapper is .kadence-inner-column-inner (not .kt-inside-inner-col)
 * - Has inner-column-{N} class for column position (1, 2, 3...)
 * - ID class uses hyphen: kadence-column-{ID} (frontend: kadence-column{ID})
 * - Contains inline <style> element for dynamic styles
 * - Has animation/direction/alignment modifier classes on inner wrapper
 *
 * Key classes:
 * - .wp-block-kadence-column      : Block identifier / outer wrapper
 * - .kadence-column               : Base column class
 * - .inner-column-{N}             : Column position (1-indexed)
 * - .kadence-column-{ID}          : Unique column identifier (hyphen before ID)
 * - .kt-column-has-bg             : Present when column has background
 * - .kadence-inner-column-inner   : Inner content wrapper (flex container)
 *
 */

/* Clip child backgrounds to rounded corners in editor.
 * Kadence sets inline border-radius: 0px on .kadence-inner-column-inner,
 * so we clip at the parent column instead.
 * Not needed on frontend — .kt-inside-inner-col gets border-radius directly.
 */
:where(.wp-block-kadence-column):where(.rounded-t-sm, .rounded-t-lg, .rounded-b-sm, .rounded-b-lg) {
    overflow: hidden;
}

/* Corresponding admin rule for content-flow default */
.kadence-inner-column-inner {
    display: flex;
    flex-direction: column;
}

/*
 * Reset padding variables in multi-column layouts to prevent inheritance from row.
 * Single-column rows retain inheritance so alignfull children can break out to row edge.
 * Mobile stacked columns also retain inheritance for full-viewport breakout.
 * Mirrors main/column.css for editor parity.
 */
@media (min-width: 768px) {
    :where(
        .kt-row-column-wrap:not(.kt-has-1-columns)
            > .innerblocks-wrap
            > .wp-block-kadence-column
            > .kadence-inner-column-inner
    ) {
        --kb-padding-left: 0;
        --kb-padding-right: 0;
    }
}

/**
 * Columns with backgrounds — structure-based vertical padding.
 *
 * Specificity: 0,1,0 - allows Kadence editor styles (0,2,0) to override
 *
 * Base: columns are cards (tight vertical, container-inner-h-sm horizontal).
 * Section contexts (single-column row) get generous vertical.
 * Wide containers upgrade horizontal padding to container-inner-h-lg.
 */
:where(.kt-column-has-bg) > .kadence-inner-column-inner {
    --kb-padding-top: var(--wp--custom--container-inner-v-sm);
    --kb-padding-bottom: var(--wp--custom--container-inner-v-sm);
    --kb-padding-left: var(--wp--custom--container-inner-h-sm);
    --kb-padding-right: var(--wp--custom--container-inner-h-sm);
    padding: var(--kb-padding-top) var(--kb-padding-right) var(--kb-padding-bottom) var(--kb-padding-left);
}

/* Section contexts: generous vertical padding, root-aligned horizontal padding */
:where(.is-root-container > .wp-block-kadence-column.kt-column-has-bg) > .kadence-inner-column-inner,
:where(.kt-has-1-columns > .innerblocks-wrap > .wp-block-kadence-column.kt-column-has-bg)
    > .kadence-inner-column-inner {
    --kb-padding-top: var(--wp--custom--container-inner-v-lg);
    --kb-padding-bottom: var(--wp--custom--container-inner-v-lg);
    --kb-padding-left: var(--wp--style--root--padding-left);
    --kb-padding-right: var(--wp--style--root--padding-right);
}

/* Wide containers: upgrade horizontal padding to container-inner-h-lg */
@container kadence-column (min-width: 580px) {
    :where(.kt-column-has-bg) > .kadence-inner-column-inner {
        --kb-padding-left: var(--wp--custom--container-inner-h-lg);
        --kb-padding-right: var(--wp--custom--container-inner-h-lg);
    }
}

/*
 * Nested Section (Column/Row-in-Column) width constraints.
 *
 * Mirrors main/column.css for editor parity.
 * See main/column.css for full documentation.
 *
 * Base rules (0,2,0): structural constraints; Kadence user-set widths
 * in <style> blocks (.kadence-column{ID}, 0,1,0) do not override these rules.
 *
 * .section-is-flex rules (0,4,0): when the parent column has Flex Alignment
 * set, Kadence generates dynamic styles at (0,3,0) with `> * { max-width:
 * 100% }` that override the base constraints. The elevated specificity here
 * beats those dynamic rules. Covers both nested Columns and nested Rows.
 */
.kadence-inner-column-inner {
    > .wp-block-kadence-column:where(:not(.alignfull):not([data-align='full'])) {
        max-width: var(--wp--style--global--content-size);
        margin-inline: auto;
        width: 100%;
    }

    > .wp-block-kadence-column:where(.alignwide, [data-align='wide']) {
        max-width: var(--wp--style--global--wide-size);
    }

    > .wp-block-kadence-column:where(.alignxwide, [data-align='xwide']) {
        max-width: var(--wp--custom--extra-wide-size, none);
    }
}

.wp-block-kadence-column > .kadence-inner-column-inner.section-is-flex {
    > :is(.wp-block-kadence-column, .wp-block-kadence-rowlayout):where(:not(.alignfull):not([data-align='full'])) {
        max-width: var(--wp--style--global--content-size);
    }

    > :is(.wp-block-kadence-column, .wp-block-kadence-rowlayout):where(.alignwide, [data-align='wide']) {
        max-width: var(--wp--style--global--wide-size);
    }

    > :is(.wp-block-kadence-column, .wp-block-kadence-rowlayout):where(.alignxwide, [data-align='xwide']) {
        max-width: var(--wp--custom--extra-wide-size, none);
    }

    > :is(.wp-block-kadence-column, .wp-block-kadence-rowlayout):where(.alignfull, [data-align='full']) {
        max-width: none;
    }

    /*
     * Rows lack the base width/centering rules that Columns get from the
     * .kadence-inner-column-inner block above, so add them here.
     */
    > .wp-block-kadence-rowlayout:where(:not(.alignfull):not([data-align='full'])) {
        margin-inline: auto;
        width: 100%;
    }
}

.is-root-container > .wp-block-kadence-column.alignxwide {
    max-width: var(--wp--custom--extra-wide-size, none);
    width: 100%;
}

.wp-block-kadence-column .kadence-inner-column-inner {
    > [data-align='full'],
    > .alignfull {
        margin-left: calc(-1 * var(--kb-padding-left));
        margin-right: calc(-1 * var(--kb-padding-right));
        width: auto !important;
        align-self: stretch;
    }
}
